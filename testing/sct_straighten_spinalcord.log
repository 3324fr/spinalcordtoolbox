
[1;32mSubject: errsm_23[0m
[1;31mContrast: t2[0m

sct_straighten_spinalcord.py 
      -i ../../data/errsm_23/t2/t2.nii.gz
      -c ../../data/errsm_23/t2/t2_centerline.nii.gz 
      -f polynomial
      -r 1
/home/django/aroux/code/spinalcordtoolbox
  OK: ../../data/errsm_23/t2/t2.nii.gz
  OK: ../../data/errsm_23/t2/t2_centerline.nii.gz

Check input arguments...
  Input volume ...................... ../../data/errsm_23/t2/t2.nii.gz
  Centerline ........................ ../../data/errsm_23/t2/t2_centerline.nii.gz
  Centerline fitting option ......... polynomial
  Final interpolation ............... spline
  Verbose ........................... 1

>> mkdir tmp.140827123925
>> cp ../../data/errsm_23/t2/t2.nii.gz tmp.140827123925
>> cp ../../data/errsm_23/t2/t2_centerline.nii.gz tmp.140827123925

Orient centerline to RPI orientation...
>> sct_orientation -i t2_centerline.nii.gz -o tmp.centerline_rpi.nii.gz -orientation RPI

Get dimensions of input centerline...
.. matrix size: 52 x 384 x 225
.. voxel size:  1.0mm x 1.0mm x 1.0mm

Open centerline volume...

Get center of mass of the centerline/segmentation...

Fit centerline in the Z-X plane using polynomial function...

Fit centerline in the Z-Y plane using polynomial function...

Get coordinates of landmarks along curved centerline...

Get coordinates of landmarks along straight centerline...

Pad input volume to deal with the fact that some landmarks on the curved centerline might be outside the FOV...
>> c3d tmp.centerline_rpi.nii.gz -pad 30x30x30vox 30x30x30vox 0 -o tmp.centerline_pad.nii.gz

Open padded centerline for reading...

Write NIFTI volumes...
.. File created: tmp.landmarks_curved.nii.gz
.. File created: tmp.landmarks_straight.nii.gz

Estimate rigid transformation between paired landmarks...
>> ANTSUseLandmarkImagesToGetAffineTransform tmp.landmarks_straight.nii.gz tmp.landmarks_curved.nii.gz rigid tmp.curve2straight_rigid.txt

Apply rigid transformation to curved landmarks...
>> WarpImageMultiTransform 3 tmp.landmarks_curved.nii.gz tmp.landmarks_curved_rigid.nii.gz -R tmp.landmarks_straight.nii.gz tmp.curve2straight_rigid.txt --use-NN

Estimate b-spline transformation: curve --> straight...
>> ANTSUseLandmarkImagesToGetBSplineDisplacementField tmp.landmarks_straight.nii.gz tmp.landmarks_curved_rigid.nii.gz tmp.warp_curve2straight.nii.gz 5x5x5 3 2 0

Concatenate rigid and non-linear transformations...
>> ComposeMultiTransform 3 tmp.curve2straight.nii.gz -R tmp.landmarks_straight.nii.gz tmp.warp_curve2straight.nii.gz tmp.curve2straight_rigid.txt

Estimate b-spline transformation: straight --> curve...
>> ANTSUseLandmarkImagesToGetBSplineDisplacementField tmp.landmarks_curved_rigid.nii.gz tmp.landmarks_straight.nii.gz tmp.warp_straight2curve.nii.gz 5x5x5 3 2 0

Concatenate rigid and non-linear transformations...
>> ComposeMultiTransform 3 tmp.straight2curve.nii.gz -R tmp.landmarks_straight.nii.gz -i tmp.curve2straight_rigid.txt tmp.warp_straight2curve.nii.gz

Apply transformation to input image...
>> WarpImageMultiTransform 3 t2.nii.gz tmp.anat_rigid_warp.nii.gz -R tmp.landmarks_straight.nii.gz spline tmp.curve2straight.nii.gz

Generate output file (in current folder)...
  File created: warp_curve2straight.nii.gz
  File created: warp_straight2curve.nii.gz
  File created: t2_straight.nii.gz

Remove temporary files...
>> rm -rf tmp.140827123925

Done!

