#!/bin/bash
# SPINALCORDTOOLBOX (added on 2016-01-27)
# Do not modify this file
# You can chose to pick a python install from anywhere on you system by
# modifying the SCT_DIR variable in  in the ${HOME}/.config/sct/config file
# e.g.
#   export SCT_PYTHON=${SCT_DIR}/bin/miniconda
# will run the toolbox with the system python on a standard linux distro
#
#
function install_conda {
  echo noting yet
}

function pick_system {

if uname -a | grep -i  darwin > /dev/null 2>&1; then
    # Do something under Mac OS X platform
  SCT_OS=osx
elif uname -a | grep -i  linux > /dev/null 2>&1; then
  SCT_OS=linux
else
  echo YOUR OPERATING SYSTEM IS NOT SUPPORTED YET
fi

}


function addtopath {
  # will not add the path again if it is already there
  # usage: addtopath "/a/directory/to/be/added" PATH_VARIABLE
  if [[ ":${!2}:" != *":$1:"* ]]; then
    bidon1="${1}:${!2}"
    eval "${2}=$bidon1"
  fi
}


if [ -z ${SCT_DIR} ]; then
  # set at installation
  SCT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
  export SCT_DIR=${SCT_DIR%/bin}
  export SCT_PYTHON=${SCT_DIR}/bin/miniconda

  export SCT_VERSION=$(cat $SCT_DIR/version.txt)

  addtopath "${SCT_DIR}/bin" PATH

  if  [ -z ${SCT_OS} ] ; then pick_system ; fi
  addtopath "${SCT_DIR}/bin/${SCT_OS}" PATH
  addtopath ${SCT_DIR}/scripts PYTHONPATH
  export PATH
  export PYTHONPATH

  export ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS=4

  if [ -e ${HOME}/.config/sct/config ]; then
    . ${HOME}/.config/sct/config
  fi
  # Will quietely fail if a virtualenv or conda is not used
  . ${SCT_PYTHON}/bin/activate ${SCT_PYTHON} > /dev/null 2>&1
fi


if   [[ "${0}" == "${BASH_SOURCE}" ]] && [[ -n "${1}"  ]]  ; then
    echo Spinacord toolbox version $SCT_VERSION
    echo running ${SCT_DIR}/scripts/${@}
    echo INSTALL PATH  SCT_DIR ${SCT_DIR}
    python ${SCT_DIR}/scripts/${@}
else
     echo sourcing sct_laucher in your environement ${SCT_DIR}
fi
