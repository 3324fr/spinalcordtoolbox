language: python
python:
  - 2.7

sudo: false
  
notifications:
  slack: neuropoly:YA3mt28aeHN3A0Iu7RvMFigK
    on_success:change
    on_failure:always

install:

# Setup Anaconda
  - ldd --version
  - wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b
  - export PATH=/home/travis/miniconda/bin:$PATH
  - conda update --yes conda
  - cd install/requirements/
  - ./requirements.sh
  - cd ../..

# SCT: set PATH
  - SCT_DIR="/home/travis/build/neuropoly/spinalcordtoolbox"
  - PATH=${PATH}:${SCT_DIR}/bin
  - PATH=${PATH}:${SCT_DIR}/bin/linux
  - export SCT_DIR PATH
  - . ~/.bashrc

# SCT: create links
  - ./install/create_links.sh -a

# SCT: compile external packages
  - ./install/compile_external.py
  - . ~/.bashrc

script:
# test dependences
  - sct_check_dependences
# test functions & integrity
  - sct_testing -d 1
# test package creation
  - cd install
  - python create_package.py -s linux
# test installation of package
  - cd ../spinalcordtoolbox_v*
  - python installer.py -p ~/
  - echo "DONE"
